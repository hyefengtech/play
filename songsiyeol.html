<!doctype html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ì†¡ì‹œì—´ ë¹™ì˜: ë‚¨ì¸ ê³µëµ ì‹œë®¬ë ˆì´í„° (MVP)</title>

  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Optional: nicer system font rendering -->
  <style>
    html { -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
  </style>
</head>

<body class="min-h-screen bg-gradient-to-b from-slate-950 via-slate-900 to-slate-950 text-slate-100">
  <!-- Subtle background glow -->
  <div class="pointer-events-none fixed inset-0 opacity-30">
    <div class="absolute -top-32 left-1/2 h-96 w-96 -translate-x-1/2 rounded-full bg-indigo-500 blur-3xl"></div>
    <div class="absolute -bottom-40 right-16 h-[28rem] w-[28rem] rounded-full bg-fuchsia-500 blur-3xl"></div>
  </div>

  <main class="relative mx-auto flex min-h-screen max-w-5xl flex-col px-4 py-10 sm:px-6">
    <!-- Header -->
    <header class="mb-8 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="grid h-10 w-10 place-items-center rounded-2xl bg-white/10 ring-1 ring-white/10">
          <span class="text-lg">ğŸ¯</span>
        </div>
        <div>
          <h1 class="text-lg font-semibold tracking-tight sm:text-xl">ì†¡ì‹œì—´ ë¹™ì˜: ë‚¨ì¸ ê³µëµ ì‹œë®¬ë ˆì´í„°</h1>
          <p class="text-xs text-slate-300 sm:text-sm">ë²„íŠ¼ë§Œ ëˆ„ë¥´ë©´ ì—”ë”©ê¹Œì§€! ë‹¹ì‹ ì˜ ë‚¨ì¸ì€ ëˆ„êµ¬ì¼ê¹Œìš”?</p>
        </div>
      </div>

      <button id="btnMute"
        class="hidden items-center gap-2 rounded-xl bg-white/10 px-3 py-2 text-xs text-slate-200 ring-1 ring-white/10 hover:bg-white/15 active:scale-[0.99] sm:flex"
        title="íš¨ê³¼ìŒ(ê°€ë²¼ìš´ í´ë¦­) í† ê¸€">
        <span id="muteIcon">ğŸ”Š</span><span class="hidden sm:inline">íš¨ê³¼ìŒ</span>
      </button>
    </header>

    <!-- App card -->
    <section class="mx-auto w-full">
      <div class="rounded-3xl bg-white/5 ring-1 ring-white/10 shadow-2xl shadow-black/30 overflow-hidden">
        <!-- Top bar -->
        <div class="flex items-center justify-between border-b border-white/10 px-6 py-4">
          <div class="flex items-center gap-3">
            <span class="inline-flex items-center rounded-full bg-white/10 px-3 py-1 text-xs text-slate-200 ring-1 ring-white/10">
              MVP Â· 7ë¬¸í•­ Â· 3ì—”ë”©(+íˆë“ )
            </span>
            <span id="statePill"
              class="hidden sm:inline-flex items-center rounded-full bg-indigo-500/15 px-3 py-1 text-xs text-indigo-200 ring-1 ring-indigo-400/20">
              ì¤€ë¹„ë¨
            </span>
          </div>

          <div class="flex items-center gap-2">
            <button id="btnReset"
              class="rounded-xl bg-white/10 px-3 py-2 text-xs text-slate-200 ring-1 ring-white/10 hover:bg-white/15 active:scale-[0.99]">
              ë‹¤ì‹œí•˜ê¸°
            </button>
            <button id="btnShare"
              class="rounded-xl bg-indigo-500/20 px-3 py-2 text-xs text-indigo-100 ring-1 ring-indigo-400/25 hover:bg-indigo-500/25 active:scale-[0.99]">
              ê²°ê³¼ ê³µìœ 
            </button>
          </div>
        </div>

        <!-- Content -->
        <div class="p-6 sm:p-8">
          <!-- Progress -->
          <div class="mb-6">
            <div class="flex items-center justify-between text-xs text-slate-300">
              <span id="progressLabel">ì‹œì‘ ì „</span>
              <span id="progressCount">0 / 7</span>
            </div>
            <div class="mt-2 h-2 w-full overflow-hidden rounded-full bg-white/10 ring-1 ring-white/10">
              <div id="progressBar" class="h-full w-0 rounded-full bg-gradient-to-r from-indigo-400 to-fuchsia-400 transition-all duration-500"></div>
            </div>
          </div>

          <!-- Two-column layout -->
          <div class="grid gap-6 lg:grid-cols-3">
            <!-- Main panel -->
            <div class="lg:col-span-2">
              <div class="rounded-3xl bg-black/20 ring-1 ring-white/10 p-6 sm:p-7">
                <div class="flex items-start gap-4">
                  <div class="grid h-12 w-12 shrink-0 place-items-center rounded-2xl bg-white/10 ring-1 ring-white/10">
                    <span id="panelIcon" class="text-xl">ğŸ•¯ï¸</span>
                  </div>
                  <div class="min-w-0">
                    <h2 id="panelTitle" class="text-base font-semibold tracking-tight sm:text-lg">ì¸íŠ¸ë¡œ</h2>
                    <p id="panelDesc" class="mt-2 text-sm leading-6 text-slate-200/90">
                      ëˆˆì„ ë– ë³´ë‹ˆâ€¦ ë„¤ ëª¸ì€ 17ì„¸ê¸° ì¡°ì„ ì˜ ì†¡ì‹œì—´<br />
                      ë¬¸ì œëŠ” í•˜ë‚˜. <span class="font-semibold text-slate-100">ë„ˆëŠ” ë‚¨ì¸ë“¤ê³¼ ì¹œí•´ì ¸ì•¼ë§Œ ì‚´ì•„ë‚¨ëŠ”ë‹¤.</span><br />
                      ì˜ëª» ê³ ë¥´ë©´? â†’ ì‚¬ì•½ ì—”ë”©
                    </p>
                  </div>
                </div>

                <!-- Choices -->
                <div id="choices" class="mt-6 grid gap-3">
                  <!-- buttons injected -->
                </div>

                <!-- Footer note -->
                <div id="hint" class="mt-5 text-xs text-slate-400">
                  íŒ: ì„ íƒì€ ëˆ„ì  ì ìˆ˜ë¡œ ë°˜ì˜ë¼. ë§ˆì§€ë§‰ì— ê°€ì¥ ë†’ì€ ì¸ë¬¼ì´ ì—”ë”©ì„ ê°€ì ¸ê°^^
                </div>
              </div>

              <!-- Toast -->
              <div id="toast"
                class="pointer-events-none mt-4 hidden rounded-2xl bg-white/10 px-4 py-3 text-sm text-slate-100 ring-1 ring-white/10">
                ë³µì‚¬ë¨!
              </div>
            </div>

            <!-- Side panel: score -->
            <aside class="rounded-3xl bg-black/20 ring-1 ring-white/10 p-6 sm:p-7">
              <div class="flex items-center justify-between">
                <h3 class="text-sm font-semibold text-slate-100">ê´€ê³„ ìˆ˜ì¹˜</h3>
                <span class="rounded-full bg-white/10 px-2.5 py-1 text-xs text-slate-200 ring-1 ring-white/10">ì‹¤ì‹œê°„</span>
              </div>

              <div class="mt-5 space-y-4">
                <div class="rounded-2xl bg-white/5 ring-1 ring-white/10 p-4">
                  <div class="flex items-center justify-between">
                    <div class="flex items-center gap-2">
                      <span>ğŸª¶</span><span class="text-sm font-medium">í—ˆëª©</span>
                    </div>
                    <span id="scoreHM" class="text-sm font-semibold tabular-nums">0</span>
                  </div>
                  <div class="mt-2 h-2 overflow-hidden rounded-full bg-white/10">
                    <div id="barHM" class="h-full w-0 rounded-full bg-white/60 transition-all duration-300"></div>
                  </div>
                  <p class="mt-2 text-xs text-slate-300">ì›ì¹™Â·ì˜ˆë²•Â·ì²­ë ´</p>
                </div>

                <div class="rounded-2xl bg-white/5 ring-1 ring-white/10 p-4">
                  <div class="flex items-center justify-between">
                    <div class="flex items-center gap-2">
                      <span>ğŸ”¥</span><span class="text-sm font-medium">ìœ¤íœ´</span>
                    </div>
                    <span id="scoreYH" class="text-sm font-semibold tabular-nums">0</span>
                  </div>
                  <div class="mt-2 h-2 overflow-hidden rounded-full bg-white/10">
                    <div id="barYH" class="h-full w-0 rounded-full bg-white/60 transition-all duration-300"></div>
                  </div>
                  <p class="mt-2 text-xs text-slate-300">ê°œí˜Â·ë…¼ìŸÂ·ì´ìƒ</p>
                </div>

                <div class="rounded-2xl bg-white/5 ring-1 ring-white/10 p-4">
                  <div class="flex items-center justify-between">
                    <div class="flex items-center gap-2">
                      <span>ğŸ</span><span class="text-sm font-medium">í—ˆì </span>
                    </div>
                    <span id="scoreHJ" class="text-sm font-semibold tabular-nums">0</span>
                  </div>
                  <div class="mt-2 h-2 overflow-hidden rounded-full bg-white/10">
                    <div id="barHJ" class="h-full w-0 rounded-full bg-white/60 transition-all duration-300"></div>
                  </div>
                  <p class="mt-2 text-xs text-slate-300">ì‹¤ë¦¬Â·ì¤„íƒ€ê¸°Â·ê¶Œë ¥</p>
                </div>
              </div>

              <div class="mt-6 rounded-2xl bg-indigo-500/10 ring-1 ring-indigo-400/20 p-4 text-xs text-indigo-100/90 leading-5">
                <p class="font-semibold text-indigo-50">íˆë“  ì¡°ê±´</p>
                <p class="mt-1">
                  ì„¸ ì¸ë¬¼ ì ìˆ˜ê°€ <span class="font-semibold">ë¹„ìŠ·í•˜ê²Œ ê°ˆë¦¬ë©´</span> â€œì¤‘ë¦½ì€ ì£½ìŒâ€ ë£¨íŠ¸ê°€ ì—´ë¦´ ìˆ˜ ìˆìŒ.
                </p>
              </div>

              <footer class="mt-6 text-xs text-slate-500">
                Â© Worldplay
              </footer>
            </aside>
          </div>
        </div>
      </div>

      <!-- Small guide 
      <div class="mx-auto mt-6 max-w-5xl text-xs text-slate-400">
        GitHub Pages: <span class="text-slate-200">index.html</span> í•˜ë‚˜ ì˜¬ë¦¬ê³  Settings â†’ Pagesì—ì„œ ë¸Œëœì¹˜ ì„ íƒí•˜ë©´ ë.
      </div>
    </section>--->
  </main>

  <script>
    // -----------------------------
    // Data
    // -----------------------------
    const CHAR = {
      HM: { key: "HM", name: "í—ˆëª©", emoji: "ğŸª¶" },
      YH: { key: "YH", name: "ìœ¤íœ´", emoji: "ğŸ”¥" },
      HJ: { key: "HJ", name: "í—ˆì ", emoji: "ğŸ" },
    };

    const intro = {
      icon: "ğŸ•¯ï¸",
      title: "ì¸íŠ¸ë¡œ",
      desc:
        `ëˆˆì„ ë– ë³´ë‹ˆâ€¦ ë„¤ ëª¸ì€ 17ì„¸ê¸° ì¡°ì„ ì˜ ì†¡ì‹œì—´.\n` +
        `\në¬¸ì œëŠ” í•˜ë‚˜.\n` +
        `ë„ˆëŠ” ë‚¨ì¸ë“¤ê³¼ ì¹œí•´ì ¸ì•¼ë§Œ ì‚´ì•„ë‚¨ëŠ”ë‹¤.\n` +
        `\nì˜ëª» ê³ ë¥´ë©´? â†’ ì‚¬ì•½ ì—”ë”©.`,
      choices: [
        { label: "ì‹œì‘í•˜ê¸°", next: 0 }
      ]
    };

    const questions = [
      {
        icon: "ğŸ“œ",
        title: "Q1. ì²« ì¶œê·¼(?) ë‚ , ì˜ˆë²• ë¬¸ì œë¡œ ì‹œë¹„ê°€ ë¶™ì—ˆë‹¤.",
        desc: "ëˆ„ê°€ â€˜ì†¡ ì„ ìƒ, ìš”ì¦˜ ë§ì´ ì¢€ ì´ìƒí•˜ì˜¤â€¦â€™ë¼ë©° ì‹œë¹„ë¥¼ ê±´ë‹¤.",
        choices: [
          { label: "â€œì˜ˆê°€ ë¬´ë„ˆì§€ë©´ ë‚˜ë¼ê°€ ë¬´ë„ˆì§„ë‹¤.â€ ì›ì¹™ëŒ€ë¡œ ë°€ì–´ë¶™ì¸ë‹¤.", add: { HM: 1 }, vibe: "ì›ì¹™" },
          { label: "â€œë…¼ë¦¬ì ìœ¼ë¡œ ë”°ì ¸ë³´ì.â€ í† ë¡ ìœ¼ë¡œ ìƒëŒ€ë¥¼ ì„¤ë“í•œë‹¤.", add: { YH: 1 }, vibe: "í† ë¡ " },
          { label: "â€œë¶„ìœ„ê¸° í’€ê³  ì •ë³´ë¶€í„°.â€ ì›ƒìœ¼ë©° ë„˜ì–´ê°€ë©° ì†ë‚´ë¥¼ ìº”ë‹¤.", add: { HJ: 1 }, vibe: "ì‹¤ë¦¬" },
        ],
      },
      {
        icon: "ğŸ‘‘",
        title: "Q2. ì™•ì´ ì€ê·¼íˆ ê°œí˜ì•ˆì„ ë¬¼ì–´ë³¸ë‹¤.",
        desc: "â€œê²½ì€ ì–´ì°Œ ìƒê°í•˜ëŠ”ê°€?â€ â€¦ì´ê±° ë‹µ ì˜ëª»í•˜ë©´ ëª©ì´ ë‚ ì•„ê°.",
        choices: [
          { label: "ê¸‰ì§„ì€ ìœ„í—˜. ì ì§„ì ìœ¼ë¡œ ë°”ê¾¸ìê³  ë§í•œë‹¤.", add: { HM: 1 }, vibe: "ì ì§„" },
          { label: "ì™•ê¶Œ ê°•í™” ì¤‘ì‹¬ì˜ ëŒ€ê°œí˜ì„ ì œì•ˆí•œë‹¤.", add: { YH: 1 }, vibe: "ê°œí˜" },
          { label: "íŒŒì¥ ê³„ì‚° í›„ ë¬´ë‚œí•œ ì•ˆìœ¼ë¡œ ì•ˆì „ë¹µ ì¹œë‹¤.", add: { HJ: 1 }, vibe: "ê³„ì‚°" },
        ],
      },
      {
        icon: "âš–ï¸",
        title: "Q3. ë‚¨ì¸ ë‚´ë¶€ ê°ˆë“±ì´ í„°ì¡Œë‹¤.",
        desc: "ì„œë¡œ ëˆˆë¹›ë§Œìœ¼ë¡œë„ ì‚´ê¸°ê°€ íë¥¸ë‹¤. ë„ˆëŠ” ì–´ë–»ê²Œ ë¼ì–´ë“¤ë˜?",
        choices: [
          { label: "ëª…ë¶„ê³¼ ì˜ˆë²•ìœ¼ë¡œ ì¤‘ì¬í•œë‹¤.", add: { HM: 1 }, vibe: "ì¤‘ì¬" },
          { label: "ê³µê°œ í† ë¡  ì—´ì–´ì„œ ëì¥ ë³´ìê³  í•œë‹¤.", add: { YH: 1 }, vibe: "ê²°íŒ" },
          { label: "ì–‘ìª½ì— ë”°ë¡œ ì ‘ê·¼í•´ ë¬¼ë°‘ í•©ì˜ë¡œ ì •ë¦¬í•œë‹¤.", add: { HJ: 1 }, vibe: "ë¬¼ë°‘" },
        ],
      },
      {
        icon: "ğŸ•µï¸",
        title: "Q4. ë„ˆì— ëŒ€í•œ í‰í‰í•œ ì†Œë¬¸ì´ ëˆë‹¤.",
        desc: "â€œì†¡ì‹œì—´ì´â€¦ ì‚¬ëŒì´ ë°”ë€ ê²ƒ ê°™ë‹¤â€ëŠ” ë§ì´ í¼ì¡Œë‹¤.",
        choices: [
          { label: "ì •ë©´ëŒíŒŒ. í•´ëª… ìƒì†Œë¥¼ ì˜¬ë¦°ë‹¤.", add: { HM: 1 }, vibe: "ì •ë©´" },
          { label: "ê³µê°œ ë…¼ìŸìœ¼ë¡œ ì—¬ë¡ ì„ ë’¤ì§‘ëŠ”ë‹¤.", add: { YH: 1 }, vibe: "ì—¬ë¡ " },
          { label: "ì†Œë¬¸ì˜ ê·¼ì›ì„ ì¡°ìš©íˆ ì œê±°í•œë‹¤.", add: { HJ: 1 }, vibe: "ì œê±°" },
        ],
      },
      {
        icon: "ğŸ¶",
        title: "Q5. ìˆ ìë¦¬ì—ì„œ ì¸ìƒê´€ì„ ë¬»ëŠ”ë‹¤.",
        desc: "ë¶„ìœ„ê¸° í’€ë¦° í‹ˆì— ëˆ„ê°€ ë¬»ëŠ”ë‹¤. â€œì†¡ ì„ ìƒì€ ë¬´ì—‡ì„ ìœ„í•´ ì‚¬ì‹œì˜¤?â€",
        choices: [
          { label: "â€œì„ ë¹„ëŠ” ì²­ë ´í•´ì•¼ í•œë‹¤.â€", add: { HM: 1 }, vibe: "ì²­ë ´" },
          { label: "â€œì„¸ìƒì€ ë°”ê¿€ ìˆ˜ ìˆë‹¤.â€", add: { YH: 1 }, vibe: "ë³€í™”" },
          { label: "â€œì‚´ì•„ë‚¨ëŠ” ê²Œ ì¤‘ìš”í•˜ì§€.â€", add: { HJ: 1 }, vibe: "ìƒì¡´" },
        ],
      },
      {
        icon: "âš ï¸",
        title: "Q6. ìœ„ê¸°: ìˆ™ì²­ ëª…ë‹¨ì— ë„¤ ì´ë¦„ì´ ì˜¤ë¥¼ ë»”í–ˆë‹¤.",
        desc: "ëˆ„êµ°ê°€ ë„ ë°€ì–´ ë„£ìœ¼ë ¤ëŠ” ëŠë‚Œì´ ë“ ë‹¤. ì§€ê¸ˆ ì›€ì§ì—¬ì•¼ í•œë‹¤.",
        choices: [
          { label: "ìƒì†Œ + ì—¬ë¡ ì „ìœ¼ë¡œ ëª…ë¶„ì„ ì„¸ìš´ë‹¤.", add: { HM: 1 }, vibe: "ëª…ë¶„" },
          { label: "ì™•ê³¼ ì§ì ‘ ë‹´íŒ. í•œ ë°©ì— ëë‚¸ë‹¤.", add: { YH: 1 }, vibe: "ë‹´íŒ" },
          { label: "ì¸ë§¥ ì´ë™ì› + ì •ì¹˜ê³µì‘ìœ¼ë¡œ ë¼ì¸ì„ ë°”ê¾¼ë‹¤.", add: { HJ: 1 }, vibe: "ë¼ì¸" },
        ],
      },
      {
        icon: "ğŸ§­",
        title: "Q7. ë§ˆì§€ë§‰ ì„ íƒ. ë„ˆì˜ ì •ì¹˜ ìŠ¤íƒ€ì¼ì€?",
        desc: "ì—¬ê¸°ì„œ ë„¤ ìƒ‰ì´ ê²°ì •ëœë‹¤. ë”± í•˜ë‚˜ë§Œ ê³ ë¥´ì.",
        choices: [
          { label: "ëª…ë¶„ê³¼ ì›ì¹™", add: { HM: 1 }, vibe: "ì›ì¹™" },
          { label: "ê°œí˜ê³¼ ì´ìƒ", add: { YH: 1 }, vibe: "ì´ìƒ" },
          { label: "ê¶Œëª¨ìˆ ìˆ˜ì™€ í˜„ì‹¤", add: { HJ: 1 }, vibe: "í˜„ì‹¤" },
        ],
      },
    ];

    const endings = {
      HM: {
        icon: "ğŸª¶",
        title: "í—ˆëª© ì—”ë”© â€” ã€Œì²­ë ´í•œ ë²—ã€",
        desc:
          `ë„ˆëŠ” ëë‚´ í—ˆëª©ê³¼ ê¹Šì€ ì‹ ë¢°ë¥¼ ìŒ“ì•˜ë‹¤.\n\n` +
          `ì›ì¹™ê³¼ ì˜ˆë²•, ê·¸ë¦¬ê³  ì²­ë ´.\n` +
          `ì„¸ìƒì€ ì‰½ê²Œ ë°”ë€Œì§€ ì•Šì•˜ì§€ë§Œ,\n` +
          `ë„ˆí¬ì˜ ì´ë¦„ì€ ì˜¤ë˜ë„ë¡ ì¡´ê²½ë°›ì•˜ë‹¤.\n\n` +
          `â€” ì¡°ì„  ìµœê³ ì˜ ì„ ë¹„ ì—”ë”© â€”`,
      },
      YH: {
        icon: "ğŸ”¥",
        title: "ìœ¤íœ´ ì—”ë”© â€” ã€Œê°œí˜ì˜ ë™ì§€ã€",
        desc:
          `ë„ˆëŠ” ìœ¤íœ´ì™€ í•¨ê»˜ ì¡°ì„ ì„ ë’¤í”ë“¤ì—ˆë‹¤.\n\n` +
          `ê¸‰ì§„ì ì´ê³  ìœ„í—˜í–ˆì§€ë§Œ,\n` +
          `ìƒˆë¡œìš´ ì‹œëŒ€ì˜ ë¬¸ì„ ì—´ì—ˆë‹¤.\n\n` +
          `â€” ì „ì„¤ì˜ ê°œí˜ê°€ ì—”ë”© â€”`,
      },
      HJ: {
        icon: "ğŸ",
        title: "í—ˆì  ì—”ë”© â€” ã€Œê¶Œë ¥ì˜ ì„¤ê³„ìã€",
        desc:
          `ë„ˆëŠ” í—ˆì ê³¼ ì†ì„ ì¡ê³  ì¡°ì„  ì •ì¹˜ì˜ íë¦„ì„ ì¡°ì¢…í–ˆë‹¤.\n\n` +
          `ê¸°ë¡ì—ëŠ” ë‚¨ì§€ ì•Šì•˜ì§€ë§Œ,\n` +
          `ì‹¤ì œ ê¶Œë ¥ì€ ì–¸ì œë‚˜ ë„ˆì˜ ì† ì•ˆì— ìˆì—ˆë‹¤.\n\n` +
          `â€” í‘ë§‰ ì—”ë”© â€”`,
      },
      BAD: {
        icon: "â˜ ï¸",
        title: "íˆë“  ë°°ë“œì—”ë”© â€” ã€Œì¤‘ë¦½ì€ ì£½ìŒã€",
        desc:
          `ëˆ„êµ¬ì˜ ì‹ ë¢°ë„ ì–»ì§€ ëª»í•œ ë„ˆ.\n\n` +
          `ì •ì¹˜ë€, ì¤‘ë¦½ìœ¼ë¡œëŠ” ì‚´ì•„ë‚¨ì„ ìˆ˜ ì—†ëŠ” ì„¸ê³„.\n\n` +
          `ì‚¬ì•½ì„ ë°›ì•˜ë‹¤.`,
      },
    };

    // -----------------------------
    // State
    // -----------------------------
    let idx = -1; // -1 = intro, 0..6 questions, 999 = ending
    let scores = { HM: 0, YH: 0, HJ: 0 };
    let resultKey = null;

    // -----------------------------
    // Elements
    // -----------------------------
    const el = {
      statePill: document.getElementById("statePill"),
      progressLabel: document.getElementById("progressLabel"),
      progressCount: document.getElementById("progressCount"),
      progressBar: document.getElementById("progressBar"),
      panelIcon: document.getElementById("panelIcon"),
      panelTitle: document.getElementById("panelTitle"),
      panelDesc: document.getElementById("panelDesc"),
      choices: document.getElementById("choices"),
      toast: document.getElementById("toast"),
      hint: document.getElementById("hint"),

      scoreHM: document.getElementById("scoreHM"),
      scoreYH: document.getElementById("scoreYH"),
      scoreHJ: document.getElementById("scoreHJ"),
      barHM: document.getElementById("barHM"),
      barYH: document.getElementById("barYH"),
      barHJ: document.getElementById("barHJ"),

      btnReset: document.getElementById("btnReset"),
      btnShare: document.getElementById("btnShare"),
      btnMute: document.getElementById("btnMute"),
      muteIcon: document.getElementById("muteIcon"),
    };

    // -----------------------------
    // Tiny click sound (no assets)
    // -----------------------------
    let muted = true; // default mute to be polite
    el.btnMute.classList.remove("hidden");
    function clickSound() {
      if (muted) return;
      try {
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        const o = ctx.createOscillator();
        const g = ctx.createGain();
        o.type = "sine";
        o.frequency.value = 520;
        g.gain.value = 0.03;
        o.connect(g);
        g.connect(ctx.destination);
        o.start();
        setTimeout(() => { o.stop(); ctx.close(); }, 55);
      } catch (_) {}
    }

    el.btnMute.addEventListener("click", () => {
      muted = !muted;
      el.muteIcon.textContent = muted ? "ğŸ”‡" : "ğŸ”Š";
      toastShow(muted ? "íš¨ê³¼ìŒ êº¼ì§" : "íš¨ê³¼ìŒ ì¼œì§");
    });

    // -----------------------------
    // Helpers
    // -----------------------------
    function clamp(n, a, b) { return Math.max(a, Math.min(b, n)); }

    function setTextWithNewlines(node, text) {
      node.innerHTML = text
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/\n/g, "<br/>");
    }

    function toastShow(msg) {
      el.toast.textContent = msg;
      el.toast.classList.remove("hidden");
      clearTimeout(toastShow._t);
      toastShow._t = setTimeout(() => el.toast.classList.add("hidden"), 1400);
    }

    function updateScoreUI() {
      el.scoreHM.textContent = scores.HM;
      el.scoreYH.textContent = scores.YH;
      el.scoreHJ.textContent = scores.HJ;

      const totalAnswered = clamp(idx, 0, questions.length); // rough
      const max = questions.length; // 7
      // bar width by score / max (not by answered) for stable feel
      el.barHM.style.width = `${(scores.HM / max) * 100}%`;
      el.barYH.style.width = `${(scores.YH / max) * 100}%`;
      el.barHJ.style.width = `${(scores.HJ / max) * 100}%`;
    }

    function updateProgressUI() {
      const max = questions.length;
      const answered = clamp(idx, 0, max); // idx indicates current question index, so answered = idx for display-ish
      const current = idx < 0 ? 0 : (idx > max ? max : idx);
      const shown = idx < 0 ? 0 : (idx >= max ? max : idx); // already passed
      const count = idx < 0 ? 0 : Math.min(idx, max);

      const step = idx < 0 ? 0 : Math.min(idx, max);
      // progress: on question i, we show i/7 as "completed"
      el.progressCount.textContent = `${step} / ${max}`;
      el.progressLabel.textContent =
        idx < 0 ? "ì‹œì‘ ì „" :
        idx >= max ? "ê²°ê³¼" :
        `ì§„í–‰ ì¤‘`;

      el.progressBar.style.width = `${(step / max) * 100}%`;
    }

    function setStatePill(text, tone = "indigo") {
      el.statePill.textContent = text;
      el.statePill.className =
        `hidden sm:inline-flex items-center rounded-full px-3 py-1 text-xs ring-1 ` +
        (tone === "indigo"
          ? "bg-indigo-500/15 text-indigo-200 ring-indigo-400/20"
          : tone === "rose"
          ? "bg-rose-500/15 text-rose-200 ring-rose-400/20"
          : "bg-emerald-500/15 text-emerald-200 ring-emerald-400/20");
    }

    function choiceButton(label, sublabel, onClick, accent = "indigo") {
      const btn = document.createElement("button");
      btn.type = "button";
      btn.className =
        "group w-full rounded-2xl bg-white/7 px-4 py-4 text-left ring-1 ring-white/10 " +
        "hover:bg-white/10 hover:ring-white/20 active:scale-[0.995] transition " +
        "focus:outline-none focus:ring-2 focus:ring-white/30";
      btn.innerHTML = `
        <div class="flex items-start justify-between gap-4">
          <div class="min-w-0">
            <div class="text-sm font-medium text-slate-100 leading-6">${escapeHtml(label)}</div>
            ${sublabel ? `<div class="mt-1 text-xs text-slate-300">${escapeHtml(sublabel)}</div>` : ""}
          </div>
          <div class="mt-0.5 shrink-0 rounded-xl px-2.5 py-1 text-[11px] ring-1 ${
            accent === "indigo"
              ? "bg-indigo-500/15 text-indigo-100 ring-indigo-400/25"
              : accent === "fuchsia"
              ? "bg-fuchsia-500/15 text-fuchsia-100 ring-fuchsia-400/25"
              : accent === "amber"
              ? "bg-amber-500/15 text-amber-100 ring-amber-400/25"
              : "bg-white/10 text-slate-200 ring-white/15"
          }">
            ì„ íƒ
          </div>
        </div>
      `;
      btn.addEventListener("click", () => { clickSound(); onClick(); });
      return btn;
    }

    function escapeHtml(s) {
      return String(s)
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }

    function renderIntro() {
      idx = -1;
      resultKey = null;
      setStatePill("ì¤€ë¹„ë¨", "indigo");
      el.panelIcon.textContent = intro.icon;
      el.panelTitle.textContent = intro.title;
      setTextWithNewlines(el.panelDesc, intro.desc);

      el.choices.innerHTML = "";
      el.choices.appendChild(
        choiceButton(intro.choices[0].label, "7ê°œì˜ ì„ íƒìœ¼ë¡œ ì—”ë”©ì´ ê°ˆë¦°ë‹¤", () => {
          nextQuestion(0);
        }, "fuchsia")
      );

      el.hint.innerHTML = `íŒ: ì ìˆ˜ëŠ” ì˜¤ë¥¸ìª½ì— í‘œì‹œë¼. ëë‚˜ë©´ ìë™ìœ¼ë¡œ ì—”ë”©!`;
      updateProgressUI();
      updateScoreUI();
      el.btnShare.disabled = true;
      el.btnShare.classList.add("opacity-60", "cursor-not-allowed");
    }

    function renderQuestion(qIndex) {
      const q = questions[qIndex];
      setStatePill(`ì§ˆë¬¸ ${qIndex + 1}/${questions.length}`, "indigo");
      el.panelIcon.textContent = q.icon;
      el.panelTitle.textContent = q.title;
      setTextWithNewlines(el.panelDesc, q.desc);

      el.choices.innerHTML = "";
      q.choices.forEach((c) => {
        const accent = c.add?.HM ? "indigo" : c.add?.YH ? "fuchsia" : "amber";
        const sub = c.add?.HM ? "ğŸª¶ í—ˆëª© +1" : c.add?.YH ? "ğŸ”¥ ìœ¤íœ´ +1" : "ğŸ í—ˆì  +1";
        el.choices.appendChild(
          choiceButton(c.label, sub, () => {
            applyScore(c.add || {});
            const next = qIndex + 1;
            if (next >= questions.length) {
              renderEnding();
            } else {
              nextQuestion(next);
            }
          }, accent)
        );
      });

      el.hint.textContent = "ì„ íƒì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŒ(â€¦ì´ë¼ ì“°ê³  ê·¸ëƒ¥ ë‹¤ì‹œí•˜ê¸° ëˆ„ë¥´ë©´ ë¨).";
      updateProgressUI();
      updateScoreUI();
    }

    function nextQuestion(qIndex) {
      idx = qIndex;
      renderQuestion(qIndex);
    }

    function applyScore(add) {
      for (const k of Object.keys(add)) {
        scores[k] += add[k];
      }
      updateScoreUI();
    }

    function computeEnding() {
      const s = scores;
      const maxVal = Math.max(s.HM, s.YH, s.HJ);
      const top = Object.entries(s).filter(([k, v]) => v === maxVal).map(([k]) => k);

      // Hidden BAD: scores are too evenly spread OR tie among 2+ at a low margin
      // "Evenly spread" heuristic: max-min <= 1 (very flat)
      const minVal = Math.min(s.HM, s.YH, s.HJ);
      const flat = (maxVal - minVal) <= 1;

      if (flat) return "BAD";
      if (top.length === 1) return top[0];

      // tie-breaker: last answered vibe doesn't exist; choose deterministic by priority
      // (you can change order if you want)
      const priority = ["HM", "YH", "HJ"];
      return top.sort((a, b) => priority.indexOf(a) - priority.indexOf(b))[0];
    }

    function renderEnding() {
      idx = 999;
      resultKey = computeEnding();
      const end = endings[resultKey];

      setStatePill("ì—”ë”©", resultKey === "BAD" ? "rose" : "emerald");
      el.panelIcon.textContent = end.icon;
      el.panelTitle.textContent = end.title;
      setTextWithNewlines(el.panelDesc, end.desc);

      el.choices.innerHTML = "";

      const summary = `ìµœì¢… ì ìˆ˜ Â· ğŸª¶í—ˆëª© ${scores.HM} / ğŸ”¥ìœ¤íœ´ ${scores.YH} / ğŸí—ˆì  ${scores.HJ}`;
      el.choices.appendChild(
        (function () {
          const box = document.createElement("div");
          box.className = "rounded-2xl bg-white/5 ring-1 ring-white/10 p-4 text-sm text-slate-100";
          box.innerHTML = `
            <div class="flex items-center justify-between gap-3">
              <div class="font-medium">ê²°ê³¼ ìš”ì•½</div>
              <div class="text-xs text-slate-300">ì¬ì‹œì‘ ê°€ëŠ¥</div>
            </div>
            <div class="mt-2 text-sm text-slate-200/90">${escapeHtml(summary)}</div>
          `;
          return box;
        })()
      );

      el.choices.appendChild(
        choiceButton("ë‹¤ì‹œí•˜ê¸°", "ë‹¤ë¥¸ ì„ íƒìœ¼ë¡œ ë‹¤ë¥¸ ì—”ë”© ë³´ê¸°", () => resetAll(), "indigo")
      );

      el.choices.appendChild(
        choiceButton("ê²°ê³¼ ê³µìœ í•˜ê¸°", "ë§í¬+í…ìŠ¤íŠ¸ ë³µì‚¬", () => shareResult(), "fuchsia")
      );

      el.hint.textContent = "ì›í•˜ë©´ ì—”ë”© í…ìŠ¤íŠ¸/ë¬¸í•­ì„ JSONì²˜ëŸ¼ ë¶„ë¦¬í•´ì„œ ë” ì‰½ê²Œ í™•ì¥í•  ìˆ˜ë„ ìˆìŒ.";
      updateProgressUI();
      updateScoreUI();

      el.btnShare.disabled = false;
      el.btnShare.classList.remove("opacity-60", "cursor-not-allowed");
    }

    function resetAll() {
      scores = { HM: 0, YH: 0, HJ: 0 };
      renderIntro();
      toastShow("ì´ˆê¸°í™” ì™„ë£Œ");
    }

    async function shareResult() {
      const base = location.href.split("#")[0];
      const key = resultKey || "NONE";
      const title = (resultKey && endings[resultKey]) ? endings[resultKey].title : "í”Œë ˆì´ ê²°ê³¼";
      const text =
`[ì†¡ì‹œì—´ ë¹™ì˜: ë‚¨ì¸ ê³µëµ ì‹œë®¬ë ˆì´í„°]
ê²°ê³¼: ${title}
ì ìˆ˜: ğŸª¶í—ˆëª© ${scores.HM} / ğŸ”¥ìœ¤íœ´ ${scores.YH} / ğŸí—ˆì  ${scores.HJ}
í”Œë ˆì´: ${base}`;

      try {
        await navigator.clipboard.writeText(text);
        toastShow("ê³µìœ  í…ìŠ¤íŠ¸ ë³µì‚¬ë¨!");
      } catch (e) {
        // fallback
        const ta = document.createElement("textarea");
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand("copy");
        ta.remove();
        toastShow("ê³µìœ  í…ìŠ¤íŠ¸ ë³µì‚¬ë¨!");
      }
    }

    // -----------------------------
    // Top buttons
    // -----------------------------
    el.btnReset.addEventListener("click", () => { clickSound(); resetAll(); });
    el.btnShare.addEventListener("click", () => { clickSound(); shareResult(); });

    // -----------------------------
    // Init
    // -----------------------------
    renderIntro();
  </script>
</body>
</html>
